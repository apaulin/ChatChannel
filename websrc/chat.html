<html>
<head>
	<style>
		.chatTableHeader
		{
			font-weight: bold;
			color: #0000aa;
			border-bottom-style: solid;
			border-bottom-width: 3px;
		}
		.chatTableBody0
		{
			color: #0000aa;
			background-color: #eeeeff;
			border-bottom-style: solid;
			border-bottom-width: 1px;
			border-bottom-color: #0000aa;
		.chatTableBody1
		{
			color: #0000aa;
			border-bottom-style: solid;
			border-bottom-width: 1px;
			border-bottom-color: #0000aa;
		}
		#chatSummary
		{
			width: 250px;
		}
	</style>
<script language="javascript">
var connection = null;
var messageCounter = 0;


var sendLogin = function()
{
	var ip = location.host;
	var wssPort = ":443";
	
	var portCfg = window.location.search.match(/\:(\d+)/);
	if (portCfg == null)
	{
		wssPort = "";
	}
	//alert(ip);
	if (gebi("loginText").value != "")
	{
		connection = new WebSocket('wss://' + ip + wssPort + '/websocket');
		connection.onopen = function () {
			console.log("Connected");
			
			connection.send('{"type":1, "uid": 0, "extras": "", "value":"'+ gebi("loginText").value +'"}'); 
			gebi("sendTextButton").disabled = false;
			gebi("loginButton").disabled = true;
			gebi("loginText").disabled = true;
			connection.onmessage = function (message) {
			  console.log("Got message", message.data);
			   
				var t  = gebi("chatSummary");
				var data = JSON.parse(message.data);
			 
				var r = t.insertRow(-1);
				var c = r.insertCell(-1);
				c.className = "chatTableBody" + (messageCounter%2);
				c.textContent = data.from;
				
				//c = r.insertCell(-1);
				//c.className = "chatTableBody" + (messageCounter%2);
				//c.textContent = data.time;

				c = r.insertCell(-1);
				c.className = "chatTableBody" + (messageCounter%2);
				c.textContent = data.value;
				
				messageCounter++;
			};
		};
		
	}
	else
	{
		alert("Please enter a name before login in.");
	}

};


// Handle all messages through this callback
  
/*
  switch(data.type) {
    case 1:
      onLogin(data.success);
      break;
    case "offer":
      onOffer(data.offer, data.name);
      break;
    case "answer":
      onAnswer(data.answer);
      break;
    case "candidate":
      onCandidate(data.candidate);
      break;
    case "leave":
      onLeave();
      break;
    default:
      break;
  }
  */

var sendMessage = function()
{
	if (gebi("inputText").value != "")
	{
		connection.send('{"type":3, "uid": 0, "extras": "", "value":"' + gebi("inputText").value + '"}');
		gebi("inputText").value = "";
		gebi("inputText").focus();
	}
}

var connectToMaster = function()
{
	connection.send('{"type":2, "value":"' + gebi("masterAddress").value + '"}');
}

var gebi = function(id)
{
	return document.getElementById(id);
}



</script>
</head>
<body>
	<table>
		<tr>
			<td><input type="text" id="loginText" /><input type="button" value="Login" id="loginButton" onclick="sendLogin();"/></td>
		</tr>
		<!-- TODO : Connecti to master type 2 with IP address -->
		<tr>
			<td><input type="text" maxlength="256" id="inputText" /><input type="button" value="Send Message" id="sendTextButton" disabled onclick="sendMessage();"/></td>
		</tr>
		<tr>
			<td>
			</td>
			<td>
				<table id="chatSummary">
					<tr>
						<td class="chatTableHeader">From</td>
						<!--<td class="chatTableHeader">Time</td> -->
						<td class="chatTableHeader">Message</td>
					</tr>
				</table>
			</td>
		</tr>
<!--		<tr>
			<td><input type="text" id="masterAddress" value="192.168.0.200" /><input type="button" value="Connect To Master" onclick="connectToMaster();"/></td>
		</tr> -->
	</table>
</body>
</html>
